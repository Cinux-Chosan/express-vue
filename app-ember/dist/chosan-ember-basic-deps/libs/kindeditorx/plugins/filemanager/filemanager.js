KindEditor.plugin("filemanager",function(e){var i=this,a="filemanager",n=e.undef(i.fileManagerJson,i.basePath+"php/file_manager_json.php"),l=i.pluginsPath+a+"/images/",t=i.lang(a+".")
function o(e,i){var a,n,l
i.is_dir?e.attr("title",i.filename):e.attr("title",(a=i.filename,n=i.filesize,l=i.datetime,a+" ("+Math.ceil(n/1024)+"KB, "+l+")"))}i.plugin.filemanagerDialog=function(r){var d=e.undef(r.width,650),s=e.undef(r.height,510),c=e.undef(r.dirName,""),m=e.undef(r.viewType,"VIEW").toUpperCase(),p=r.clickFn,f=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+l+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+t.moveup+"</a>","</div>",'<div class="ke-right">',t.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+t.viewImage+"</option>",'<option value="LIST">'+t.listImage+"</option>","</select> ",t.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+t.fileName+"</option>",'<option value="SIZE">'+t.fileSize+"</option>",'<option value="TYPE">'+t.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join(""),u=i.createDialog({name:a,width:d,height:s,title:i.lang(a),body:f}),v=u.div,h=e(".ke-plugin-filemanager-body",v),g=(e('[name="moveupImg"]',v),e('[name="moveupLink"]',v)),k=(e('[name="viewServer"]',v),e('[name="viewType"]',v)),_=e('[name="orderType"]',v)
function b(a,l,t){var o="path="+a+"&order="+l+"&dir="+c
u.showLoading(i.lang("ajaxLoading")),e.ajax(e.addParam(n,o+"&"+(new Date).getTime()),function(e){u.hideLoading(),t(e)})}var w=[]
function y(i,a,n,l){var t=e.formatUrl(a.current_url+n.filename,"absolute"),o=encodeURIComponent(a.current_dir_path+n.filename+"/")
n.is_dir?i.click(function(e){b(o,_.val(),l)}):(n.is_photo,i.click(function(e){p.call(this,t,n.filename)})),w.push(i)}function C(i,a){function n(){"VIEW"==k.val()?b(i.current_dir_path,_.val(),I):b(i.current_dir_path,_.val(),T)}e.each(w,function(){this.unbind()}),g.unbind(),k.unbind(),_.unbind(),i.current_dir_path&&g.click(function(e){b(i.moveup_dir_path,_.val(),a)}),k.change(n),_.change(n),h.html("")}function T(i){C(i,T)
var a=document.createElement("table")
a.className="ke-table",a.cellPadding=0,a.cellSpacing=0,a.border=0,h.append(a)
for(var n=i.file_list,o=0,r=n.length;o<r;o++){var d=n[o],s=e(a.insertRow(o))
s.mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")})
var c=l+(d.is_dir?"folder-16.gif":"file-16.gif"),m=e('<img src="'+c+'" width="16" height="16" alt="'+d.filename+'" align="absmiddle" />'),p=e(s[0].insertCell(0)).addClass("ke-cell ke-name").append(m).append(document.createTextNode(" "+d.filename))
!d.is_dir||d.has_file?(s.css("cursor","pointer"),p.attr("title",d.filename),y(p,i,d,T)):p.attr("title",t.emptyFolder),e(s[0].insertCell(1)).addClass("ke-cell ke-size").html(d.is_dir?"-":Math.ceil(d.filesize/1024)+"KB"),e(s[0].insertCell(2)).addClass("ke-cell ke-datetime").html(d.datetime)}}function I(i){C(i,I)
for(var a=i.file_list,n=0,r=a.length;n<r;n++){var d=a[n],s=e('<div class="ke-inline-block ke-item"></div>')
h.append(s)
var c=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")})
s.append(c)
var m=i.current_url+d.filename,p=d.is_dir?l+"folder-64.gif":d.is_photo?m:l+"file-64.gif",f=e('<img src="'+p+'" width="80" height="80" alt="'+d.filename+'" />')
!d.is_dir||d.has_file?(c.css("cursor","pointer"),o(c,d),y(c,i,d,I)):c.attr("title",t.emptyFolder),c.append(f),s.append('<div class="ke-name" title="'+d.filename+'">'+d.filename+"</div>")}}return k.val(m),b("",_.val(),"VIEW"==m?I:T),u}})
